function googleError(){$("#map").html("<h2>Sorry! Google Maps failed to load. Please check your internet connection and try refreshing the page.</h2>")}var initMap=function(){var e={disableDefaultUI:!0,center:{lat:40.7614547802915,lng:-73.9200578197085}};map=new google.maps.Map(document.getElementById("map"),e);var a=new google.maps.LatLng(40.753547,-73.942808),t=new google.maps.LatLng(40.782769,-73.897018),r=new google.maps.LatLngBounds;r.extend(a),r.extend(t),map.fitBounds(r),ko.applyBindings(new ViewModel)},Place=function(e){this.venue=ko.observable(e.name),this.lat=ko.observable(e.lat),this.lng=ko.observable(e.lng),this.address=ko.observable(e.address),this.city=ko.observable(e.city),this.category=ko.observable(e.category),this.rating=ko.observable(e.rating),this.id=ko.observable(e.id),this.website=ko.observable(e.website),this.ref=ko.observable(e.ref)},ViewModel=function(){var e=this,a=[{name:"SingleCut Beersmiths",website:"http://www.singlecutbeer.com/",lat:40.7783129,lng:-73.9017037,category:"Brewery Bar",address:"19-33 37th St, Astoria",rating:9.4,ref:"jeremyLocations"},{name:"Doyle's Corner",website:"https://foursquare.com/v/doyles-corner/4b42d0b4f964a52022da25e3",lat:40.7580005,lng:-73.9173563,category:"Bar and Grill",address:"4202 Broadway, Astoria",rating:8.1,ref:"jeremyLocations"},{name:"Yaar Indian Restaurant",website:"http://www.yaarindianrestaurant.net/",lat:40.774797,lng:-73.911866,category:"Indian Restaurant",address:"22-55 31st St, Astoria",rating:8.4,ref:"jeremyLocations"},{name:"Bai Sushi",website:"https://foursquare.com/v/bai-sushi/4b2062f2f964a520a53124e3",lat:40.7597557,lng:-73.92021869999999,category:"Sushi Restaurant",address:"37-03 Broadway, Astoria",rating:7.9,ref:"jeremyLocations"},{name:"New York City Bagel & Coffee House",website:"http://nycbch.com/",lat:40.7589623,lng:-73.9185095,category:"Coffee and Bagel Shop",address:"40-05 Broadway, Astoria",rating:8.7,ref:"jeremyLocations"},{name:"Pye Boat Noodle",website:"http://www.pyeboatnoodle.com/",lat:40.7604336,lng:-73.921568,category:"Thai Restaurant",address:"35-13 Broadway, Astoria",rating:9,ref:"jeremyLocations"},{name:"Cafe Boulis",website:"http://www.cafeboulis.com/",lat:40.7646088,lng:-73.92354440000001,category:"Greek Bakery",address:"31-15 31st Ave, Astoria",rating:8.4,ref:"jeremyLocations"},{name:"Bear",website:"https://foursquare.com/v/bear/4eb00b6ef9f463d3c3c7880c",lat:40.768372,lng:-73.93303,category:"Russian Restaurant",address:"12-14 31st Ave, Long Island City",rating:8.5,ref:"jeremyLocations"},{name:"Villa Brazil",website:"http://villabrasilcafe.com/",lat:40.7551288,lng:-73.9180253,category:"Brazilian Buffet",address:"43-16 34th Ave, Long Island City",rating:9,ref:"jeremyLocations"}],t=[],r=[],o=[],n=[];this.mapLocations=ko.observableArray(),this.displayResults=function(){e.mapLocations.removeAll(),e.clearMarkers(),e.createMarker(r)},this.displayJerLoc=function(){e.mapLocations.removeAll(),e.clearMarkers(),t.length=0,e.createLocations(a),e.createMarker(t)},this.displaySaved=function(){e.mapLocations([]),e.clearMarkers(),n.length=0;var a=JSON.parse(localStorage.getItem("savedLocations"));e.createSavedLocations(a)},this.pushSave=function(e){delete e.marker,localStorage.savedLocations||(localStorage.savedLocations=JSON.stringify([]));var a=JSON.parse(localStorage.savedLocations);-1===JSON.stringify(a).indexOf(e.venue())&&(a.push(e),localStorage.savedLocations=ko.toJSON(a))},this.getFourSquare=function(){var a={clientId:"Y2I0LGBKFU2FCQLC3XOQEH4CIV1R4IKT4X10CT1FPAZS2VYC",clientSecret:"HVHDQBVKYMWSV5Q45AH44VAFMRF1D5TTE41J41YRYGAZ253R",apiUrl:"https://api.foursquare.com/"};$.ajax({url:a.apiUrl+"v2/venues/explore",dataType:"json",data:"ll=40.7614547802915,-73.9200578197085&radius=5000&section=food&client_id="+a.clientId+"&client_secret="+a.clientSecret+"&v=20140806&m=foursquare",async:!0,success:function(a){venue=a.response.groups[0].items,e.clearMarkers(),e.createLocations(venue)},error:function(e){$("#location-list").html("<h4><p>Sorry! The FourSquare data failed to load.</p> <p>Please check your internet connection and try refreshing the page, or look at Jeremy's Recommendations.</p></h4>")}})},this.getFourSquare(),this.createLocations=function(a){for(var o=0;o<a.length;o++)if("ref"in a[o]){var n=a[o],i=n.name,s=n.address,l=n.category,c=n.rating,g=n.lat,d=n.lng,m=n.website,u=n.ref,p={name:i,address:s,lat:g,lng:d,category:l,rating:c,website:m,ref:u};t.push(new Place(p))}else{var n=a[o].venue,i=n.name,f=n.location,l=n.categories[0].name,c=n.rating,h=n.id,p={name:i,address:f.address,city:f.city,lat:f.lat,lng:f.lng,category:l,rating:c,id:h};r.push(new Place(p))}a.length>=29&&e.createMarker(r)},this.createSavedLocations=function(a){for(var t=0;t<a.length;t++){var r=a[t],o=r.venue,i=r.address,s=r.city,l=r.category,c=r.rating,g=r.lat,d=r.lng,m=r.id,u=r.ref,p=r.website,f={name:o,address:i,lat:g,lng:d,category:l,rating:c,website:p,id:m,ref:u,city:s};n.push(new Place(f))}e.createMarker(n)},this.markerArray=ko.observableArray([]);var i,s;this.createMarker=function(a){e.clearMarkers();for(var t=0;t<a.length;t++)!function(a){var t=new google.maps.LatLng(a.lat(),a.lng()),r="https://foursquare.com/v/",n=document.createElement("div");if(void 0===a.ref()){var l=new google.maps.Marker({position:t,map:map,clickable:!0,animation:google.maps.Animation.DROP});n.innerHTML="<div id='info-content'><a href ='"+r+a.id()+"'>"+a.venue()+"</a><br>"+a.category()+"<br>"+a.address()+", "+a.city()+"<br>FourSquare Rating: "+a.rating()+" out of 10</div>"}else l=new google.maps.Marker({position:t,map:map,clickable:!0,animation:google.maps.Animation.DROP,icon:"dist/images/img/1458190296_location_3-03.svg"}),n.innerHTML="<div id='info-content'><a href ='"+a.website()+"'>"+a.venue()+"</a><br>"+a.category()+"<br>"+a.address()+"<br>FourSquare Rating: "+a.rating()+" out of 10</div>";s=n.appendChild(document.createElement("input")),s.type="button",s.value="Save location!",google.maps.event.addDomListener(s,"click",function(){-1===o.indexOf(a)&&(o.push(a),e.pushSave(a))}),e.mapLocations.push(a),e.markerArray.push(l),google.maps.event.addListener(l,"click",function(){null!==l.getAnimation()?l.setAnimation(null):l.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){l.setAnimation(null)},1200)},!1),google.maps.event.addListener(l,"click",function(){i&&i.close(),i=new google.maps.InfoWindow({content:n}),i.open(map,l)}),google.maps.event.addListener(map,"click",function(){i&&i.close()}),a.marker=l}(a[t])},this.openInfoWindow=function(e){google.maps.event.trigger(e.marker,"click")},this.setMarkerMap=function(a){for(var t=0;t<e.markerArray.length;t++)e.markerArray[t].setMap(a)},this.clearMarkers=function(a){e.setMarkerMap(null),e.markerArray=[]};var l=document.getElementById("hamburger"),c=document.getElementById("nav-bar");l.addEventListener("click",function(e){"open"==c.className?c.className="":c.className="open",e.preventDefault()},!1),this.query=ko.observable(""),this.search=ko.computed(function(a){return ko.utils.arrayFilter(e.mapLocations(),function(a){return a.category().toLowerCase().indexOf(e.query().toLowerCase())>=0?(a.marker&&a.marker.setVisible(!0),!0):void a.marker.setVisible(!1)})})};